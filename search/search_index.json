{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Privacy Pact documentation","text":"<p>Welcome to the Privacy Pact monorepo docs. This file is the landing page for developer-facing docs and links to package README files and examples.</p> <p>Table of contents</p> <ul> <li>Overview</li> <li>Packages</li> <li>@privacy-pact/adapter-prisma</li> <li>@privacy-pact/server</li> <li>@privacy-pact/client</li> <li>Examples</li> <li>Running tests</li> <li>Prisma integration test</li> <li>CI notes</li> </ul>"},{"location":"#overview","title":"Overview","text":"<p>The repository contains the Privacy Pact library split into packages under <code>packages/</code> and an example Express app under <code>examples/express-app</code>.</p>"},{"location":"#packages","title":"Packages","text":"<ul> <li><code>packages/adapter-prisma</code> \u2014 Prisma adapter docs and integration test instructions.</li> <li><code>packages/server</code> \u2014 Server package docs.</li> <li><code>packages/client</code> \u2014 Client package docs.</li> </ul> <p>Each package contains a <code>README.md</code> with usage and package-specific notes. Check the package folder for additional examples and migration hints.</p>"},{"location":"#examples","title":"Examples","text":"<p>See <code>examples/express-app/README.md</code> for a runnable Express example demonstrating consent endpoints and DSR flows.</p>"},{"location":"#running-tests","title":"Running tests","text":"<p>Run tests per-package or run the full suite from the repo root.</p> <p>From repo root (runs workspace scripts):</p> <pre><code>npm test\n</code></pre> <p>Run a single package's tests (example below shows adapter-prisma):</p> <pre><code>npm run -w @privacy-pact/adapter-prisma test\n</code></pre>"},{"location":"#prisma-integration-test","title":"Prisma integration test","text":"<p>The <code>@privacy-pact/adapter-prisma</code> package includes a lightweight integration test that:</p> <ul> <li>creates a temporary SQLite database file under your OS temp directory</li> <li>runs <code>prisma db push</code> against the package's <code>prisma/schema.prisma</code> to sync the schema</li> <li>instantiates <code>PrismaClient</code> pointing at the temp DB and exercises <code>PrismaAdapter</code> end-to-end</li> <li>cleans up the temporary DB file when the test finishes</li> </ul> <p>To run the integration test locally (PowerShell):</p> <pre><code># from the repo root (uses npm workspaces)\nnpm run -w @privacy-pact/adapter-prisma test\n\n# OR: run from the package folder\ncd packages\\adapter-prisma\nnpm install\nnpm test\n</code></pre> <p>Notes</p> <ul> <li>The test uses <code>npx prisma db push --schema=...</code> which avoids creating migration files and keeps the test isolated and repeatable.</li> <li>If <code>prisma</code>/<code>@prisma/client</code> are not installed, install them in the package: <code>npm install prisma @prisma/client --save-dev</code>.</li> <li>The integration test file is <code>packages/adapter-prisma/src/integration.test.ts</code>.</li> </ul>"},{"location":"#ci-notes","title":"CI notes","text":"<ul> <li>Because the integration test calls the Prisma CLI, you may want to run it in a separate CI job so it doesn't slow down unit-test feedback loops.</li> </ul>"},{"location":"adapter-prisma/","title":"Adapter Prisma","text":""},{"location":"adapter-prisma/#privacy-pactadapter-prisma","title":"@privacy-pact/adapter-prisma","text":"<p>Prisma adapter for Privacy Pact. This package provides a thin <code>PrismaAdapter(prisma)</code> function that implements the <code>ComplianceAdapter</code> interface used by <code>@privacy-pact/server</code>.</p> <p>Quick example</p> <pre><code>import { PrismaClient } from '@prisma/client'\nimport { PrismaAdapter } from '@privacy-pact/adapter-prisma'\n\nconst prisma = new PrismaClient()\nconst adapter = PrismaAdapter(prisma)\n</code></pre> <p>Prisma schema</p> <p>Add the following <code>ConsentLog</code> model to your Prisma schema (see <code>prisma/schema.prisma</code> in this package for a starting point).</p> <p>Notes</p> <ul> <li>The adapter expects a <code>consentLog</code> model with a <code>userIdentifier</code> field and will call <code>prisma.consentLog.create(...)</code> and <code>prisma.consentLog.findMany(...)</code>.</li> <li>You may prefer to store <code>categories</code> as a <code>Json</code> type (Postgres/MySQL) or as a separate normalized table for querying by category.</li> <li>This adapter is intentionally minimal; adapt to your app's needs.</li> </ul> <p>DSR (Data Subject Request) logging</p> <p>If you'd like the adapter to record DSR activity for auditing workflows, add the following <code>DsrRequest</code> model to your Prisma schema (it's included in <code>prisma/schema.prisma</code> in this package):</p> <pre><code>model DsrRequest {\n    id             String   @id @default(cuid())\n    userIdentifier String\n    type           String   // 'access' | 'delete'\n    status         String?  // optional status (e.g. 'requested', 'completed')\n    metadata       Json?    // optional JSON blob with extra details\n    createdAt      DateTime @default(now())\n\n    @@index([userIdentifier])\n    @@index([type])\n}\n</code></pre> <p>With that model present, <code>PrismaAdapter.logDsrRequest</code> will attempt to create a record when DSR endpoints are used.</p> <p>Migration</p> <p>Run Prisma migrate to add the new table to your database:</p> <pre><code>npx prisma migrate dev --name add_dsr_request\n</code></pre> <p>Or use <code>prisma db push</code> for a quick sync in development (non-migrated):</p> <pre><code>npx prisma db push\n</code></pre> <p>Privacy note</p> <p>Storing DSR requests helps with compliance audits but may itself be personal data. Consider retention and minimization policies for these records.</p> <p>Local development with SQLite</p> <p>The package includes a <code>.env.example</code> configured for SQLite. To run migrations locally (PowerShell on Windows):</p> <pre><code>cd packages\\adapter-prisma\n# install prisma tooling if you haven't already\nnpm install prisma @prisma/client --save-dev\n# copy env example\ncopy .env.example .env\n# generate client\nnpx prisma generate\n# run migration (creates dev.db)\nnpx prisma migrate dev --name init\n</code></pre> <p>Alternatively you can run the helper script which will copy <code>.env.example</code> to <code>.env</code>, run <code>prisma generate</code> and <code>prisma migrate</code>:</p> <pre><code>npm run prisma:setup\n</code></pre> <p>This will create <code>dev.db</code> next to <code>schema.prisma</code> when using the SQLite provider.</p>"},{"location":"adapter-prisma/#running-the-integration-tests-locally","title":"Running the integration tests locally","text":"<p>The repository includes an end-to-end integration test that spins up a temporary SQLite database, pushes the package Prisma schema to it, and exercises <code>PrismaAdapter</code>. The test is fast and isolated (it creates and removes a temp DB file).</p> <p>Prerequisites</p> <ul> <li>Node.js and npm available.</li> <li><code>prisma</code> and <code>@prisma/client</code> installed in the workspace (the repo already includes them as dev deps).</li> </ul> <p>Run the test (PowerShell / Windows)</p> <pre><code># from the repo root (uses npm workspaces)\nnpm run -w @privacy-pact/adapter-prisma test\n\n# OR: run from the package folder\ncd packages\\adapter-prisma\nnpm install\nnpm test\n</code></pre> <p>Notes</p> <ul> <li>The integration test uses <code>npx prisma db push --schema=...</code> to sync the schema into a temporary     SQLite file under your OS temp directory. That means it doesn't create migration files and is     safe to run repeatedly.</li> <li>If you encounter issues where <code>npx prisma</code> is not found, ensure <code>prisma</code> is installed locally in     the package (run <code>npm install prisma --save-dev</code>) or run <code>npx --yes prisma ...</code>.</li> <li>The test file is <code>src/integration.test.ts</code> and will clean up the temporary DB file when it finishes.</li> </ul> <p>If you want this test to run in CI, consider adding a separate job because it invokes the Prisma CLI and is slower than pure unit tests.</p>"},{"location":"client/","title":"Client","text":""},{"location":"client/#privacy-pactclient","title":"@privacy-pact/client","text":"<p>Client-side React components and hooks.</p> <p>Exports</p> <ul> <li><code>ComplianceProvider</code> \u2014 Wrap your app and provide <code>apiBaseUrl</code>.</li> <li><code>useConsent()</code> \u2014 Hook to read consent state and log consent actions.</li> <li><code>CookieBanner</code> \u2014 Simple cookie banner that asks for analytics consent.</li> </ul> <p>Usage (Next.js App Router)</p> <p>In <code>app/layout.tsx</code>:</p> <pre><code>import { ComplianceProvider, CookieBanner } from '@privacy-pact/client'\n\nexport default function RootLayout({ children }: { children: React.ReactNode }) {\n    return (\n        &lt;html&gt;\n            &lt;body&gt;\n                &lt;ComplianceProvider apiBaseUrl=\"/api/compliance\"&gt;\n                    &lt;CookieBanner /&gt;\n                    {children}\n                &lt;/ComplianceProvider&gt;\n            &lt;/body&gt;\n        &lt;/html&gt;\n    )\n}\n</code></pre> <p>Notes</p> <ul> <li><code>ComplianceProvider</code> fetches <code>GET /consent</code> on mount and exposes <code>logConsent</code> which posts to <code>POST /consent</code>.</li> <li>For production, wire <code>apiBaseUrl</code> to the actual endpoint where you mount the <code>@privacy-pact/server</code> handlers.</li> </ul>"},{"location":"examples/","title":"Examples","text":""},{"location":"examples/#express-example-for-privacy-pact","title":"Express Example for Privacy Pact","text":"<p>This minimal example shows how to wire the <code>@privacy-pact/server</code> handlers into an Express app using an in-memory adapter.</p> <p>Quick start:</p> <ol> <li>cd examples/express-app</li> <li>npm install</li> <li>npm start</li> </ol> <p>The server will run at http://localhost:3000 and expose: - POST /api/compliance/consent - GET  /api/compliance/consent</p> <p>Additional DSR endpoints (demo): - POST /api/compliance/dsr-access - POST /api/compliance/dsr-delete</p> <p>Headers: - <code>x-user-id</code>: optional user identifier; defaults to <code>anon</code>.</p> <p>Notes: - This example imports TypeScript source from the monorepo packages. It runs via <code>ts-node</code> so you don't need to pre-build packages. - In production, implement a persistent adapter (e.g., Prisma) and wire it into handlers.</p> <p>DSR demo usage (PowerShell / Windows):</p> <p>1) Request data access (will send a console \"email\"):</p> <pre><code>curl -Method POST -Uri http://localhost:3000/api/compliance/dsr-access -Headers @{ 'x-user-id'='user-123'; 'x-user-email'='user@example.com' }\n</code></pre> <p>2) Request data deletion:</p> <pre><code>curl -Method POST -Uri http://localhost:3000/api/compliance/dsr-delete -Headers @{ 'x-user-id'='user-123'; 'x-user-email'='user@example.com' }\n</code></pre> <p>Expected console output (the example uses ConsoleEmailAdapter and will log emails):</p> <pre><code>---[Privacy Pact Email]---\nTo: user@example.com\nSubject: Your data\nBody:\nAttached is your data.\nAttachments:\n- user-data.json (xxx chars)\n---[End Email]---\n</code></pre> <p>If you prefer to run the example without runtime path-mapping, build the packages first:</p> <pre><code>npm run -w @privacy-pact/server build\nnpm run -w @privacy-pact/types build\ncd .\\examples\\express-app\nnpm start\n</code></pre>"},{"location":"publish-local/","title":"Local dry-run for publish workflow","text":"<p>This document explains how to simulate the key steps of the publish workflow locally: packing packages and optionally signing the generated tarballs.</p> <p>Prerequisites</p> <ul> <li>Node.js and npm</li> <li><code>gpg</code> CLI if you want to test GPG signing</li> <li><code>cosign</code> CLI cannot perform keyless OIDC signing locally (requires GitHub Actions OIDC). You can test <code>cosign</code> signing with a locally-provided key if desired.</li> </ul> <p>Pack changed packages (example: pack all packages)</p> <p>From the repo root, run PowerShell:</p> <pre><code>npm run build\nfor ($p in Get-ChildItem packages -Directory) { pushd $p.FullName; npm pack; popd }\n</code></pre>"},{"location":"publish-local/#tarballs-will-be-created-under-each-package-folder","title":"tarballs will be created under each package folder","text":"<p>Collect tarballs to a temp folder</p> <pre><code>mkdir tmp\\publish-assets\nGet-ChildItem packages -Recurse -Filter *.tgz | ForEach-Object { Copy-Item $_.FullName tmp\\publish-assets }\n</code></pre> <p>GPG sign tarballs (optional)</p> <pre><code># Import your key (ASCII-armored file)\ngpg --import my-private-key.asc\n\n# Sign each tarball\nGet-ChildItem tmp\\publish-assets -Filter *.tgz | ForEach-Object { gpg --batch --yes --passphrase \"$env:GPG_PASSPHRASE\" --output ($_.FullName + '.sig') --detach-sign $_.FullName }\n</code></pre> <p>Cosign keyless signing note</p> <p>Keyless cosign signing uses OIDC and only works inside GitHub Actions. To test cosign locally use a key pair and run <code>cosign sign-blob --key cosign.key &lt;file&gt;</code> after generating keys.</p> <pre><code># generate a key pair (not keyless)\ncosign generate-key-pair\ncosign sign-blob --key cosign.key my-package.tgz\n</code></pre> <p>After a successful dry run you can inspect the generated tarballs and signatures in <code>tmp/publish-assets</code>.</p>"},{"location":"server/","title":"Server","text":""},{"location":"server/#privacy-pactserver","title":"@privacy-pact/server","text":"<p>Core server helpers for Privacy Pact.</p> <p>What this package provides</p> <ul> <li>Type definitions (<code>ConsentLogData</code>, <code>ComplianceAdapter</code>, etc.) in <code>@privacy-pact/types</code>.</li> <li>Handler helpers you can use inside your server routes:<ul> <li><code>handleConsentPost(config)</code></li> <li><code>handleConsentGet(config)</code></li> <li><code>handleDsrAccessPost(config)</code> (Phase 2 skeleton)</li> <li><code>handleDsrDeletePost(config)</code> (Phase 2 skeleton)</li> </ul> </li> </ul> <p>Usage example (Express)</p> <pre><code>import express from 'express'\nimport { PrismaClient } from '@prisma/client'\nimport { PrismaAdapter } from '@privacy-pact/adapter-prisma'\nimport { handleConsentPost, handleConsentGet } from '@privacy-pact/server'\n\nconst app = express()\nconst prisma = new PrismaClient()\nconst adapter = PrismaAdapter(prisma)\n\napp.post('/api/compliance/consent', async (req, res) =&gt; {\n    const userIdentifier = req.headers['x-user-id'] as string || 'anon'\n    const result = await handleConsentPost({ adapter, requestBody: req.body, userIdentifier })\n    if (result.success) res.json({ success: true })\n    else res.status(400).json(result)\n})\n\napp.get('/api/compliance/consent', async (req, res) =&gt; {\n    const userIdentifier = req.headers['x-user-id'] as string || 'anon'\n    const result = await handleConsentGet({ adapter, userIdentifier })\n    res.json(result)\n})\n</code></pre> <p>Notes</p> <ul> <li>The package is framework-agnostic \u2014 use the handlers in Next.js API routes, Express, or any server.</li> <li>See <code>@privacy-pact/types</code> for shared type contracts.</li> </ul>"}]}